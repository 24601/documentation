---
Titre: "Utiliser OpenReplay avec Nuxt"
metaTitle: "Ajouter le suiveur OpenReplay dans votre application Nuxt.js"
metaDescription: "Apprenez √† faire fonctionner le suiveur sur votre application Nuxt"
---
import GoDeeperFooter from '~/components/go-deeper-footer.astro'

Il est assez simple d'obtenir le suiveur pour fonctionner sur une application Nuxt.

## Ajouter le code de suivi

Bien que vous puissiez obtenir une version copier-coller du code directement √† partir de la plate-forme lorsque vous cr√©ez un nouveau projet, ce code est trop basique et peut ne pas suivre les meilleures pratiques attendues par votre √©quipe ou votre entreprise.

Au lieu de cela, vous pouvez essayer de moduler le code fourni de cette fa√ßon:


```jsx
import Tracker from '@openreplay/tracker';
import {v4 as uuidV4} from 'uuid'

function defaultGetUserId() {
   return uuidV4() 
}

export function startTracker(config) {

    console.log("Starting tracker...")

    const getUserId = (config?.userIdEnabled && config?.getUserId) ? config.getUserId : defaultGetUserId
    let userId = null;

    const trackerConfig = {
        projectKey: config?.projectKey
    }

    const tracker = new Tracker(trackerConfig);

    if(config?.userIdEnabled) {
        userId = getUserId()
        tracker.setUserID(userId)
    }

    tracker.start();
    return {
        tracker,
        userId
    }
}
```


Cette fonction s'occupe d'instancier le Suiveur et d'appeler la m√©thode `start`, qui fait fonctionner les choses.

Cette fonction prend √©galement en charge un objet de "configuration" que vous pouvez √©tendre pour des fonctionnalit√©s futures. Cet exemple vous montre comment activer, en option, la possibilit√© d'identifier les utilisateurs de mani√®re unique. Vous pouvez utiliser un UUID par d√©faut qui serait unique pour chaque utilisateur chaque fois qu'ils visitent la page. Vous pouvez √©galement fournir une fonction `getUserId` personnalis√©e en tant que partie de la configuration.

Avec votre fonction personnalis√©e, vous pourriez fournir l'ID client de votre magasin, l'adresse e-mail de l'utilisateur ou tout ce qui identifie de mani√®re unique l'utilisateur dans votre application. De cette fa√ßon, vous pouvez suivre leurs reprises de session dans le temps au cas o√π ils auraient un probl√®me particulier que d'autres ne signalent pas.

Dans cet exemple, la cl√© du projet, que vous pouvez obtenir √† partir de l'interface utilisateur du projet OpenReplay, est cens√©e √™tre pass√©e √† l'int√©rieur de l'objet `config` sur la cl√© `projectKey`.

## √âcrire un plugin client uniquement

Pour utiliser cette fonction `startTracker`, vous voudrez cr√©er un plugin client uniquement dans le r√©pertoire `plugins` de votre projet Nuxt.

Assurez-vous d'ajouter le suffixe `.client` au nom du fichier de votre plugin. C'est pour s'assurer que Nuxt ne le charge que sur le client.

Le code du plugin pourrait ressembler √† ceci:


```jsx
import {startTracker} from '../utils/tracker'

export default defineNuxtPlugin( (nuxtApp) => {
    
    return {
        provide: {
            startTracking: () => {
                let config = useRuntimeConfig().public
                
                let {userId} = startTracker({
                    userIdEnabled: true,
                    projectKey: config.openreplayProjectKey
                })
                //Optional if you need it
                let uid = useUserId()
                uid.value = userId
            }
        }
    }
})
```


Si vous souhaitez en savoir plus sur la cr√©ation de plugins Nuxt, vous pouvez consulter [sa documentation](https://v3.nuxtjs.org/guide/directory-structure/plugins).

Maintenant, ce plugin fournit une fonction appel√©e `startTracking`, qui s'occupe d'appeler la fonction `startTracker` que nous avons d√©finie avant. Mais plus important encore, √† l'int√©rieur du code du plugin, vous pouvez obtenir la variable d'environnement o√π vous avez stock√© la cl√© du projet. Rappelez-vous, cette information ne doit pas √™tre cod√©e dans votre projet pour des raisons de s√©curit√©.

Gr√¢ce √† la fonction `useRuntimeConfig`, vous pouvez acc√©der aux variables d'environnement publiques. Dans cet exemple, j'acc√®de √† `openreplayProjectKey` qui est d√©fini comme `NUXT_PUBLIC_OPENREPLAY_PROJECT_KEY`.

üí° **Remarque** le pr√©fixe `NUXT_PUBLIC`, cela permet √† Nuxt de partager la variable avec le front-end; sinon, elle ne sera accessible qu'√† votre code back-end uniquement.

L'exemple ci-dessus vous montre √©galement comment utiliser la valeur d'ID d'utilisateur retourn√©e avec un composable pour partager la valeur entre les composants. Ces deux lignes sont enti√®rement facultatives.

## Utiliser le suiveur

Avec le plugin enregistr√© dans un fichier, vous pouvez ensuite l'utiliser de cette fa√ßon √† partir de votre fichier `app.vue`.


```jsx
<script setup>
onMounted( () => {
  const {$startTracking} = useNuxtApp()
  $startTracking()
})
</script>

<template>
  <div>
    <NuxtPage />
  </div>
</template>
```

