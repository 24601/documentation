---
titre: "Utiliser le plugin VueX pour capturer les changements d'état"
metaTitle: "Utiliser le plugin VueX pour capturer les changements d'état"
metaDescription: "Apprenez à capturer les changements d'état en utilisant le plugin VueX et à les visualiser dans les reprises de session"
---
Si vous utilisez VueX pour gérer l'état de vos applications basées sur Vue, l'intégration du [plugin OpenReplay](https://docs.openreplay.com/plugins/vuex) pour suivre les mises à jour d'état est très simple.

Si vous souhaitez suivre le tutoriel, utilisez [le code publié](https://github.com/deleteman/openreplay-vuex-example) ici.

## Intégration du traceur dans votre code

La première chose à laquelle nous devons nous soucier est l'intégration du traceur OpenReplay dans le projet. Nous traitons d'un projet basé sur Vue, ce qui signifie que notre point d'entrée sera le fichier `main.js`. Installez d'abord le traceur avec:


```tsx
yarn add @openreplay/tracker
```


Ou utilisez npm si vous préférez:


```tsx
npm install @openreplay/tracker
```


Maintenant que c'est fait, une fois que vous avez configuré le projet dans la plateforme, obtenez la clé du projet et enregistrez-la dans un fichier `.env` situé à la racine du projet.


```bash
VUE_APP_OPENREPLAY_PROJECT_KEY=<your project key here>
```


Remarquez le nom de la variable d'environnement. Il commence par `VUE_APP_` car lorsque nous le faisons, WebPack remplacera sa valeur partout où nous utilisons le code `process.env.VUE_APP_OPENREPLAY_PROJECT_KEY` pour nous éviter d'avoir à envoyer le fichier de configuration réel au client.

Maintenant, à l'intérieur de votre dossier `src`, créez un dossier `tracker` et un fichier `index.js` à l'intérieur. Ce fichier exportera une seule fonction: `startTracker` qui configura tout et démarrera le traceur.


```jsx
import Tracker from '@openreplay/tracker';

import {v4 as uuidV4} from 'uuid'

function defaultGetUserId() {
   return uuidV4() 
}

export function startTracker(config) {

    console.log("Starting tracker...")

    const getUserId = (config?.userIdEnabled && config?.getUserId) ? config.getUserId : defaultGetUserId
    let userId = null;

    const trackerConfig = {
        projectKey: config.projectKey
    }

    const tracker = new Tracker(trackerConfig);

    const pluginReturns = {}
    Object.keys(config?.plugins).forEach( pk => {
        pluginReturns[pk] = tracker.use(config?.plugins[pk]())
    })
 
    if(config?.userIdEnabled) {
        userId = getUserId()
        tracker.setUserID(userId)
    }
    console.log("tracker: user id: ", userId)

    tracker.start();
    return {
        tracker,
        userId,
        ...pluginReturns
    }
}
```


Ce à quoi vous devez vous soucier maintenant, c'est que cette fonction fait tout ce dont vous avez besoin. Tout ce que vous avez à faire est de passer la clé du projet lors de son appel. Comme ceci (à partir du fichier `main.js`):


```jsx
import {startTracker} from './tracker/index'

let {vuexTracker} = startTracker({
    projectKey: process.env.VUE_APP_OPENREPLAY_PROJECT_KEY,
})
```


Comme nous l'avons déjà vu, la ligne `process.env.VUE_APP_OPENREPLAY_PROJECT_KEY` sera remplacée par votre clé de projet réelle lors du rendu de la page.

Maintenant, ajoutons le plugin VueX afin que nous puissions également commencer à suivre les changements d'état.

## Ajout du plugin VueX

Le plugin est facilement installé avec une seule ligne:


```jsx
yarn add @openreplay/tracker-vuex
```


Après cela, nous pouvons l'importer dans notre code et le passer en tant qu'objet de configuration à la fonction `startTracker`.

Revenez à la définition de cette fonction et remarquez comment nous avons déjà du code pour gérer les plugins. En fait, l'élément `plugins` de la configuration est une carte qui reçoit les plugins (avec une clé de notre choix) et renvoie ce que nous obtenons en appelant la méthode `use`, également, sur la même clé que nous avons utilisée pour le plugin.

Laissez-moi vous montrer, c'est encore une fois sur le fichier `main.js`:


```jsx
//your other imports go here...
import trackerVuex from '@openreplay/tracker-vuex';
import store from './store'

let {vuexTracker} = startTracker({
    userIdEnabled: true,
    projectKey: process.env.VUE_APP_OPENREPLAY_PROJECT_KEY,
    plugins:{
      'vuexTracker': trackerVuex
    } 
})

new Vue({
  router,
  store: store([vuexTracker]),
  render: h => h(App)
}).$mount('#app')
```


Remarquez comment nous:

1. Appelons la fonction `startTracker` avec la carte `plugins`. La chaîne "vuexTracker" est quelque chose que j'ai inventé à l'époque, mais vous pouvez utiliser n'importe quelle chaîne ici.
2. Nous déstructurons la réponse et obtenons la clé "vuexTracker" (la même clé que nous avons utilisée pour la carte). Tant que ces deux clés correspondent, vous pouvez utiliser n'importe quelle chaîne.
3. Nous passons la fonction `vuexTracker` en tant que paramètre à la fonction `store`.

La variable vuexTracker contient essentiellement notre plugin VueX, ce plugin sera connecté au magasin VueX et pour cela nous utilisons le code suivant:


```jsx
import Vue from 'vue'
import Vuex from 'vuex'

import account from './account'
import product from './product'

Vue.use(Vuex)

export default function (plugins = []) {
  return function() {
    const Store = new Vuex.Store({
      modules: {
        account,
        product
      },

      strict: process.env.DEV,
      plugins
    })

    return Store
  }
}
```

