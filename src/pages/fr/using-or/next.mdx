---
titre: "Utiliser OpenReplay avec Next.js"
metaTitle: "Ajouter le suiveur OpenReplay √† votre application Next.js"
metaDescription: "Apprenez √† faire fonctionner le suiveur sur votre application Next.js"
---
import GoDeeperFooter from '~/components/go-deeper-footer.astro'

Faire fonctionner le suiveur sur une application Next.js est assez simple. Comme Next.js fonctionne sur React, le processus est assez similaire, la principale difficult√© vient des capacit√©s de rendu c√¥t√© serveur de Next.js.

Mais une fois que vous comprenez comment elles fonctionnent et comment structurer votre code client uniquement, vous serez en train de suivre vos utilisateurs en un rien de temps.

## Ajout du code de suivi

Bien que vous puissiez obtenir une version copier-coller du code directement √† partir de la plate-forme lorsque vous cr√©ez un nouveau projet, ce code est trop basique et peut ne pas suivre les meilleures pratiques attendues par votre √©quipe ou votre entreprise.

Au lieu de cela, vous pouvez cr√©er un fournisseur de contexte qui permet √† tous les composants envelopp√©s par celui-ci de d√©marrer le processus de suivi:


```jsx
import { createContext } from "react"
import Tracker from '@openreplay/tracker';
import {v4 as uuidV4} from 'uuid'
import { useReducer } from "react"

export const TrackerContext = createContext()

function defaultGetUserId() {
   return uuidV4() 
}

function newTracker(config) {
    const getUserId = (config?.userIdEnabled && config?.getUserId) ? config.getUserId : defaultGetUserId
    let userId = null;

    const trackerConfig = {
        projectKey: config?.projectKey || process.env.NEXT_PUBLIC_OPENREPLAY_PROJECT_KEY
    }

    const tracker = new Tracker(trackerConfig);

    if(config?.userIdEnabled) {
        userId = getUserId()
        tracker.setUserID(userId)
    }
    return tracker

}

function reducer(state, action) {
        switch(action.type) {
            case 'init': {
                if(!state.tracker) {
                    console.log("Instantiaing the tracker for the first time...")
                    return {...state, tracker: newTracker(state.config)}
                }
                return state
            }
            case 'start': {
                console.log("Starting tracker...")
                state.tracker.start()
                return state
            }
        }
    }

export default function TrackerProvider({children, config = {}}) {
    let [state, dispatch] = useReducer(reducer, {tracker: null, config})
    let value = {
        startTracking: () => dispatch({type: 'start'}),
        initTracker: () => dispatch({type: 'init'})
    }

    return <TrackerContext.Provider value={value}>{children}</TrackerContext.Provider>
}
```


Ce fournisseur met √† disposition de l'utilisateur 2 m√©thodes:

- `initTracker`: qui instancie le suiveur avec la configuration fournie.
- `startTracking`: qui d√©clenche le d√©but du processus de suivi.

Ce fournisseur prend √©galement en charge un objet "configuration" que vous pouvez √©tendre pour des fonctionnalit√©s futures. Cet exemple vous montre comment activer, en option, la possibilit√© d'identifier de mani√®re unique les utilisateurs. Vous pouvez utiliser un UUID par d√©faut qui serait unique pour chaque utilisateur chaque fois qu'ils visitent la page. Vous pouvez √©galement fournir une fonction `getUserId` personnalis√©e en tant que partie de la configuration.

Avec votre fonction personnalis√©e, vous pourriez fournir l'ID client de votre magasin, ou l'adresse e-mail de l'utilisateur ou tout ce qui identifie de mani√®re unique l'utilisateur dans votre application. De cette fa√ßon, vous pouvez suivre leurs sessions de relecture dans le temps au cas o√π ils auraient un probl√®me particulier que d'autres ne signalent pas.

üí°**Note pour les utilisateurs h√©berg√©s en local**: si vous utilisez la version h√©berg√©e en local d'OpenReplay, vous devrez √©galement sp√©cifier la propri√©t√© de configuration `ingestPoint`. Cette propri√©t√© sp√©cifie le point d'ingestion des donn√©es du suiveur. Les utilisateurs du cloud n'ont pas besoin de cela, car par d√©faut, le suiveur saura o√π se trouve le point d'extr√©mit√© de la version SaaS, mais si vous l'h√©bergez en local, vous devrez le sp√©cifier (ce devrait √™tre quelque chose comme `https://openreplay.mydomain.com/ingest`)

### Gestion de la "projectKey" dans votre code

Comme note, la `projectKey` que vous configurez est celle fournie par la plate-forme OpenReplay. Cette valeur ne doit pas √™tre stock√©e en dur dans votre code pour des raisons de s√©curit√©, mais plut√¥t dans un fichier/syst√®me de configuration.

Pour cet exemple, je profite des fichiers `.env` de Next. Ce que vous devez comprendre, c'est que si vous ne pr√©fixez pas la variable d'environnement avec `NEXT_PUBLIC`, votre code client (le suiveur) n'y aura pas acc√®s.

Si cela n'est pas acceptable, vous pouvez utiliser `getStaticProps` √† partir de la premi√®re page que vos utilisateurs visitent pour obtenir cette valeur avant d'instancier le suiveur. Vous pouvez voir les deux exemples ci-dessous.

## Utilisation du contexte du suiveur

Importez et enveloppez votre application avec le `TrackerProvider` que nous avons cr√©√© avant, comme ceci:


```jsx
import '../styles/globals.css'
import TrackerProvider from '../context/trackerContext'

function MyApp({ Component, pageProps }) {

  return <TrackerProvider>
        <Component {...pageProps} />
    </TrackerProvider>
}

export default MyApp
```


Ceci est le fichier `_app.js`, qui agit comme point d'entr√©e pour l'ensemble de l'application.

Et ensuite, vous pouvez d√©clencher le suivi depuis n'importe quel composant que vous souhaitez, comme ceci:


```jsx
import { useContext, useEffect } from 'react'
import { TrackerContext } from '../context/trackerContext'
import styles from '../styles/Home.module.css'

export default function YourComponent({projectKey}) {
    
    const {initTracker, startTracking} = useContext(TrackerContext)
    
    useEffect( () => {
       initTracker()
       startTracking()
    }, [])
//.... rest of your code
}
```

