Заголовок: «GraphQL»
Мета-заголовок: «GraphQL»
Мета-описание: «Плагин GraphQL для OpenReplay».

Этот плагин позволяет захватывать запросы GraphQL и просматривать их позже при воспроизведении записей сеансов. Это очень полезно для понимания и устранения проблем. Плагин GraphQL совместим с реализациями Apollo и Relay.

<Совет>
У нас также есть подробное руководство по использованию плагина GraphQL для захвата и изменения запросов, вы можете посмотреть его здесь.
</Совет>

## Установка


```bash
npm i @openreplay/tracker-graphql
```


## Использование

Вызов плагина вернет функцию, которая принимает четыре переменные: «operationKind», «operationName», «variables» и «result». Она возвращает «result» без изменений.

### Если ваш сайт является одностраничным приложением (SPA)


```js
import OpenReplay from '@openreplay/tracker';
import trackerGraphQL from '@openreplay/tracker-graphql';
//...
const tracker = new OpenReplay({
  projectKey: PROJECT_KEY,
});

export const recordGraphQL = tracker.use(trackerGraphQL());

tracker.start();
```


### Если ваше веб-приложение отрисовывается на стороне сервера (SSR)

Следуйте приведенному ниже примеру, если ваше приложение отрисовывается на стороне сервера. Убедитесь, что вызов «tracker.start()» происходит один раз после запуска приложения на стороне клиента (в «useEffect» или «componentDidMount»).


```js
// openreplay.js
import OpenReplay from '@openreplay/tracker/cjs';
import trackerGraphQL from '@openreplay/tracker-graphql/cjs';

export const tracker = new OpenReplay({
  projectKey: PROJECT_KEY
});
export const recordGraphQL = tracker.use(trackerGraphQL());

// MyApp.js
import { tracker } from './openreplay';

function MyApp() {
  useEffect(() => { // use componentDidMount in case of React Class Component
    tracker.start();
  }, [])
}
//...
```


### Relay

Для [Relay](https://relay.dev/) вы должны вручную вставить вызов «recordGraphQL» в реализацию «NetworkLayer». Если у вас есть стандартный способ реализации «Network.create», то вы должны следовать приведенному ниже примеру.


```js
import { Environment } from 'relay-runtime';
import { recordGraphQL } from './openreplay'; // see above for recordGraphQL definition

//...
function fetchQuery(operation, variables, cacheConfig, uploadables) {
  return fetch('ENDPOINT', {
  //...
  })
    .then(response => response.json())
    .then(result =>
      recordGraphQL(operation.operationKind, operation.name, variables, result)
    );
}
//...
const network = Network.create(fetchQuery);
```


См. [Relay Network Layer](https://relay.dev/docs/en/network-layer) для подробностей.

### Apollo

Для [Apollo](https://www.apollographql.com/) вам нужно создать новую ссылку «ApolloLink» с вызовом «recordGraphQL» и поместить ее в цепочку. Вот пример того, как это сделать.


```js
import { ApolloLink } from '@apollo/client';
import { recordGraphQL } from './openreplay'; // see above for recordGraphQL definition

const trackerApolloLink = new ApolloLink((operation, forward) => {
  return forward(operation).map(result) => {
    const operationDefinition = operation.query.definitions[0];
    return recordGraphQL(
      operationDefinition.kind === 'OperationDefinition' ? operationDefinition.operation : 'unknown?',
      operation.operationName,
      operation.variables,
      result
    );
  });
});
//...
const link = ApolloLink.from([
  trackerApolloLink,
  //...
]);
```

